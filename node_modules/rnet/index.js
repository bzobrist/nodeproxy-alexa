//Test
nanoid = require("nanoid")
key = nanoid(12)
listeners = []
function call(what,data){
  for(x in listeners){
    if(listeners[x].name == what){
      listeners[x].call(data)
    }
  }
}
module.exports.on = function(what,callback){
    data = {"name":what,"call":function(data){callback(data)}}
}
module.exports.open = function(server){
  server.get('/',(res,req)=>{
    if(res.headers["socket"] == true){
      req.end(JSON.stringify({message: "success","key":key,"id":nanoid(6)}))
    }
  })
  server.get('/gen/:key',(res,req)=>{
    if(res.headers["socket"] != true){
      return
    }
    if(res.params.key == key){
      req.end(JSON.stringify({message: "Success"}))
    }else{
      req.end(JSON.stringify({message: "Not found"}))
    }
  })
  server.post('/gen/:key',(res,req)=>{
    if(res.params.key == key){
      call(res.body.name,res.body.data)
    }
  })
}
module.exports.send = function(name,data){
  
}